<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>Image Uploader</title>
  <style>
    body
    {
      background-image:  url(2.png);
      background-repeat: repeat;
    }
    span
    {
      color: white;
    }
    .hidden
    {
      display:none;
    }
  </style>
 </head>
 <body>
   <div id="logged_status"><a href="/login">Login</a><a href="/signup">Sign Up</a></div> 

   <span>Search for a book</span><input type="text" name="title2" id="title2" />
   <button id ="try" >Fetch this book's cover!</button>

   <div id="choices"></div>
   <div id="info" class="hidden"></div>
   <a href="/add" class="hidden">Add Review</a>

   <script src="jquery.js"></script>
   <script>
     var auth=[];
     var desc=[];
     var ISBN=[];
     var title=[];
     function chosen(choice)
       {
       	  //send to server and store this image
       	  console.log("chosen " + choice);
          for(var i = 0;i<5;i++)
       	  {
       	  	if(i!==choice) $('#choice-'+i).hide(1000*(1-i*0.2));
       	  }
          //show data about this book
          var html1 = title[choice] + "<hr>" + ISBN[choice] + "<hr>";
          var html2 = "";
          if(auth[choice])
          {
           html2 = auth[choice][0];
           console.log(html2);
           for(var j =1;j<auth[choice].length;j++)
           {
             html2 += ',  ' + auth[choice][j];
           } 
          }
          var html = html1 + html2;
          html += '<hr>Description: ' + desc[choice] + "<hr>";
          $('#info').html(html);
          console.log('hello, please display');
          $('.hidden').css("display","block");

       }
     $(function()
     {
       alert('hello');
       $.get('/logged_status',function(data)
       {
         console.dir(data);
         if(data !== '')
         {
          $('#logged_status').html('Welcome '+data.username);
         }
       })
       $('#try').click(function()
       {  
          alert($('#title2').val());
          var end_point = "https://www.googleapis.com/books/v1/volumes"; 
          $.get(end_point,{q: $('#title2').val(),maxResults:"5",fields:"items(accessInfo/pdf/downloadLink,volumeInfo(authors,description,imageLinks,industryIdentifiers/identifier,title))"},function(data)
          {
            alert('ok');
            console.log(data);
            for(var i=0; i<5 && i<data.items.length;i++)
            {
             if("volumeInfo" in data.items[i] && "imageLinks" in data.items[i].volumeInfo && "thumbnail" in data.items[i].volumeInfo.imageLinks)
             {
              var thumb = data.items[i].volumeInfo.imageLinks.thumbnail;
              console.log('here it comes');
              auth[i] = data.items[i].volumeInfo.authors;
              console.log('here it comes-2');
              desc[i] = data.items[i].volumeInfo.description;
              console.log('here it comes-3');
              console.dir(data.items[i].volumeInfo.industryIdentifiers);
              if(data.items[i].volumeInfo.industryIdentifiers[0].identifier.length === 13)
                ISBN[i] = data.items[i].volumeInfo.industryIdentifiers[0].identifier;
              else
                ISBN[i] = data.items[i].volumeInfo.industryIdentifiers[1].identifier;
              console.log(ISBN[i]);
              title[i] = data.items[i].volumeInfo.title;
              console.log(title[i]);
              if(i===0) $('#choices').html('<img id="choice-' + i + '" src="' + thumb + '"  onclick="chosen('+i+');"></img>');
              else $('#choices').append('<img id="choice-' + i + '" src="' + thumb + '" onclick="chosen('+i+');"></img>');
             }
            }
            console.log(data);
          });
          alert('after get');
       });
     });
   </script>
 </body>
</html>
